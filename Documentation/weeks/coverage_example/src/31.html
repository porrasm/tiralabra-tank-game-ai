<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>p:\stuff\projects\minigamesproject\minigamesproject\assets\_assets\scripts\games\tankgame\tankplayer.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using BeardedManStudios.Forge.Networking;
using BeardedManStudios.Forge.Networking.Generated;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class TankPlayer : MonoBehaviour {

    #region fields
    private TankNetworking net;

    private int roundWins;
    private int kills;
    private int assists;

    private float healthDegen;

    // Switch with common class for special settings
    public bool Invulnerable { get; set; }

    public enum PlayerState { Disabled = 0, Locked = 1, Enabled = 2 }
    #endregion

    private void Start() {
        net = GetComponent&lt;TankNetworking&gt;();
        net.Health = TankSettings.Health;
    }
    private void Update() {
        UpdateHealth();
    }

    #region Game
    public void DoDamage(int damage, TankPlayer player) {

        net.Health -= damage;

        if (net.Health &lt;= 0) {
            SetPlayerState(PlayerState.Disabled);
            player.KilledPlayer(this);
        }
    }

    public void KillPlayer() {
        SetPlayerState(PlayerState.Disabled);
    }
    public void SetPlayerState(PlayerState state) {

        if (net == null) {
            print(&quot;net was null&quot;);
        }
        if (net.networkObject == null) {
            print(&quot;net object was null&quot;);
        }

        if (!net.networkObject.IsServer) {
            return;
        }

        GetComponent&lt;TankController&gt;().StopTank();

        net.ChangeState(state);

        UpdateState();
    }
    private void UpdateState() {

        if (net.State == PlayerState.Enabled) {
            EnableChildren(true);
            SetAlive();
        }
        if (net.State == PlayerState.Locked) {
            EnableChildren(true);
        }
        if (net.State == PlayerState.Disabled) {
            EnableChildren(false);
            Kill();
        }
    }
    private void EnableChildren(bool enable) {
        foreach (Transform child in transform) {
            child.gameObject.SetActive(enable);
        }
    }

    private void UpdateHealth() {

        // DO NOT LOWER HEALTH WHEN REGENERATING

        if (net.State != PlayerState.Enabled) {
            return;
        }

        if (net.Health &gt; TankSettings.MaxHealth) {
            net.Health = TankSettings.MaxHealth;
        }

        if (net.Health &gt;= TankSettings.Health) {
            healthDegen += Time.deltaTime * TankSettings.HealthLossRatePerSecond;
        }

        if (healthDegen &gt; 1) {
            net.Health -= (int)healthDegen;
            healthDegen -= (int)healthDegen;
        }
    }
    #endregion

    #region Events
    public void KilledPlayer(TankPlayer player) {

        if (Equals(player)) {
            player.AddScore(TankSettings.SuicideScore);
            player.kills--;
        } else {
            player.AddScore(TankSettings.KillScore);
            player.kills++;
        }
    }
    public void WinRound() {
        roundWins++;
        AddScore(TankSettings.WinScore);
    }
    #endregion

    private void SetAlive() {
        net.Health = TankSettings.Health;
    }
    private void Kill() {
        net.Health = 0;
    }

    public void AddScore(int score) {
        net.TankScore += score;
    }

    public override bool Equals(object other) {

        TankPlayer p = other as TankPlayer;

        if (p == null) {
            return false;
        }

        return net.Owner.ID == p.net.Owner.ID;
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[19,32,19,36,0],[19,37,19,41,0],[24,26,24,27,0],[25,9,25,46,0],[26,9,26,42,0],[27,5,27,6,0],[28,27,28,28,0],[29,9,29,24,0],[30,5,30,6,0],[33,57,33,58,0],[35,9,35,30,0],[37,9,37,29,0],[37,30,37,31,0],[38,13,38,50,0],[39,13,39,39,0],[40,9,40,10,0],[41,5,41,6,0],[43,30,43,31,0],[44,9,44,46,0],[45,5,45,6,0],[46,51,46,52,0],[48,9,48,25,0],[48,26,48,27,0],[49,13,49,35,0],[50,9,50,10,0],[51,9,51,39,0],[51,40,51,41,0],[52,13,52,42,0],[53,9,53,10,0],[55,9,55,41,0],[55,42,55,43,0],[56,13,56,20,0],[59,9,59,51,0],[61,9,61,32,0],[63,9,63,23,0],[64,5,64,6,0],[65,32,65,33,0],[67,9,67,46,0],[67,47,67,48,0],[68,13,68,34,0],[69,13,69,24,0],[70,9,70,10,0],[71,9,71,45,0],[71,46,71,47,0],[72,13,72,34,0],[73,9,73,10,0],[74,9,74,47,0],[74,48,74,49,0],[75,13,75,35,0],[76,13,76,20,0],[77,9,77,10,0],[78,5,78,6,0],[79,46,79,47,0],[80,9,80,16,0],[80,18,80,33,0],[80,34,80,36,0],[80,37,80,46,0],[80,48,80,49,0],[81,13,81,48,0],[82,9,82,10,0],[83,5,83,6,0],[85,33,85,34,0],[89,9,89,46,0],[89,47,89,48,0],[90,13,90,20,0],[93,9,93,49,0],[93,50,93,51,0],[94,13,94,49,0],[95,9,95,10,0],[97,9,97,47,0],[97,48,97,49,0],[98,13,98,82,0],[99,9,99,10,0],[101,9,101,29,0],[101,30,101,31,0],[102,13,102,44,0],[103,13,103,45,0],[104,9,104,10,0],[105,5,105,6,0],[109,49,109,50,0],[111,9,111,28,0],[111,29,111,30,0],[112,13,112,56,0],[113,13,113,28,0],[114,9,114,10,0],[114,16,114,17,0],[115,13,115,53,0],[116,13,116,28,0],[117,9,117,10,0],[118,5,118,6,0],[119,28,119,29,0],[120,9,120,21,0],[121,9,121,41,0],[122,5,122,6,0],[125,29,125,30,0],[126,9,126,42,0],[127,5,127,6,0],[128,25,128,26,0],[129,9,129,24,0],[130,5,130,6,0],[132,37,132,38,0],[133,9,133,32,0],[134,5,134,6,0],[136,47,136,48,0],[138,9,138,44,0],[140,9,140,23,0],[140,24,140,25,0],[141,13,141,26,0],[144,9,144,47,0],[145,5,145,6,0]]);
    </script>
  </body>
</html>