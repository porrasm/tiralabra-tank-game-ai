<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>p:\stuff\projects\minigamesproject\minigamesproject\assets\_assets\scripts\games\tankgame\tankai\tankai.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class TankAI : MonoBehaviour {

    #region fields
    private TankControls controls;
    private TankNetworking net;

    private TankDFSPath dfs;
    private TankAStarPath aStar;

    private Vector[] path;

    private TankAIMovement movement;
    private TankAIBulletChecker bullets;
    #endregion

    private void Start() {
        controls = GetComponent&lt;TankControls&gt;();
        net = GetComponent&lt;TankNetworking&gt;();

        TankGameManager.Instance().SubscribeRoundStart(ResetAI);
    }

    public void ResetAI() {

        print(&quot;reset ai&quot;);

        StopAllCoroutines();

        dfs = new TankDFSPath(TankLevelGenerator.Instance.Level);
        aStar = new TankAStarPath(TankLevelGenerator.Instance.Level);
        path = null;

        movement = new TankAIMovement(this);
        bullets = new TankAIBulletChecker(this);

        path = aStar.FindPath(Vector.PositionToCoords(transform.position),
            Vector.PositionToCoords(TankNetworking.MyTank().transform.position));

        movement.TraversePath(path);

        TankEvents.Instance.SubscribeToEvent(BulletEvent, TankEvents.EventType.BulletEvent);
    }

    private void BulletEvent() {

        print(&quot;Bullet event&quot;);

        bullets.CheckCollisionStatus();
        if (bullets.BulletWillHit) {
            DodgeBullets();
        }
    }

    private void Update() {

        if (net.State != TankPlayer.PlayerState.Enabled) {
            return;
        }

        ResetControls();


        if (Input.GetKeyDown(KeyCode.R)) {
            ResetAI();
        }
    }

    private void DodgeBullets() {

        print(&quot;Dodging bullet&quot;);

        IntCoords current = Vector.PositionToCoords(transform.position);
        movement.TraversePath(bullets.GetPathToSafeCoords(current, aStar));
    }

    private void ResetControls() {
        controls.ResetControls();
    }


}

public class AISettings {
    public static float TurnAngleLimit = 10f;
    public static float DistanceLimit = 0.5f;
    public static float MovementAngle = 15;

    #region Stuck settings
    public static float StuckTresholdTime = 0.2f;
    public static float StuckTresholdDistance = 0.05f;
    public static float AllowedStuckTime = 0.2f;
    public static float StuckCooldown = 0.5f;
    #endregion
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[20,26,20,27,0],[21,9,21,49,0],[22,9,22,46,0],[24,9,24,65,0],[25,5,25,6,0],[27,27,27,28,0],[29,9,29,27,0],[31,9,31,29,0],[33,9,33,57,0],[34,9,34,61,0],[35,9,35,21,0],[37,9,37,45,0],[38,9,38,49,0],[40,9,41,82,0],[43,9,43,37,0],[45,9,45,93,0],[46,5,46,6,0],[48,32,48,33,0],[50,9,50,31,0],[52,9,52,40,0],[53,9,53,35,0],[53,36,53,37,0],[54,13,54,28,0],[55,9,55,10,0],[56,5,56,6,0],[58,27,58,28,0],[60,9,60,57,0],[60,58,60,59,0],[61,13,61,20,0],[64,9,64,25,0],[67,9,67,41,0],[67,42,67,43,0],[68,13,68,23,0],[69,9,69,10,0],[70,5,70,6,0],[72,33,72,34,0],[74,9,74,33,0],[76,9,76,73,0],[77,9,77,76,0],[78,5,78,6,0],[80,34,80,35,0],[81,9,81,34,0],[82,5,82,6,0],[88,5,88,46,0],[89,5,89,46,0],[90,5,90,44,0],[93,5,93,50,0],[94,5,94,55,0],[95,5,95,49,0],[96,5,96,46,0]]);
    </script>
  </body>
</html>