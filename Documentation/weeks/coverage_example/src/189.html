<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>p:\stuff\projects\minigamesproject\minigamesproject\assets\_assets\scripts\games\tankgame\tankai\components\tankaibulletchecker.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

/// &lt;summary&gt;
/// Used to calculate all the future trajectories of bullets
/// &lt;/summary&gt;
public class TankAIBulletChecker : TankAIComponent {

    #region fields

    private TankBulletTrajectory[] trajectories;

    public byte[,] CellBulletCounts { get; private set; }
    public bool BulletWillHit { get; set; }
    #endregion

    public TankAIBulletChecker(TankAI ai) : base(ai) {
    }

    public override void Update() {
        CheckCollisionStatus();
    }

    /// &lt;summary&gt;
    /// Calculates the trajectories of all bullets and saves which how many bullets will pass over a certain cell
    /// &lt;/summary&gt;
    public void CheckCollisionStatus() {

        BulletWillHit = false;

        CellBulletCounts = new byte[TankSettings.LevelWidth, TankSettings.LevelHeight];

        GameObject[] bullets = GameObject.FindGameObjectsWithTag(&quot;Bullet&quot;);

        trajectories = new TankBulletTrajectory[bullets.Length];

        for (int i = 0; i &lt; bullets.Length; i++) {
            TankBulletTrajectory t = new TankBulletTrajectory(this, bullets[i].GetComponent&lt;TankBullet&gt;());
            t.CalculateTrajectory();

            TankPathVisualizer.DrawRoute(t.Trajectory);

            if (t.HitAI) {
                BulletWillHit = true;
            }
        }
    }

    /// &lt;summary&gt;
    /// Returns a path to safe coordinates which no bullet will pass over
    /// &lt;/summary&gt;
    /// &lt;param name=&quot;current&quot;&gt;&lt;/param&gt;
    /// &lt;param name=&quot;pf&quot;&gt;&lt;/param&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public Vector[] GetPathToSafeCoords(IntCoords current, TankAIPathfinding pf) {

        bool FoundCondition(IntCoords c) {
            return CellBulletCounts[c.x, c.y] == 0;
        }

        return pf.FindPath(current, new IntCoords(-1, -1), FoundCondition);
    } 
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[14,39,14,43,0],[14,44,14,56,0],[15,33,15,37,0],[15,38,15,42,0],[18,45,18,53,0],[18,54,18,55,0],[19,5,19,6,0],[21,35,21,36,0],[22,9,22,32,0],[23,5,23,6,0],[28,40,28,41,0],[30,9,30,31,0],[32,9,32,88,0],[34,9,34,76,0],[36,9,36,65,0],[38,14,38,23,0],[38,25,38,43,0],[38,45,38,48,0],[38,50,38,51,0],[39,13,39,108,0],[40,13,40,37,0],[42,13,42,56,0],[44,13,44,25,0],[44,26,44,27,0],[45,17,45,38,0],[46,13,46,14,0],[47,9,47,10,0],[48,5,48,6,0],[56,82,56,83,0],[58,42,58,43,0],[59,13,59,52,0],[60,9,60,10,0],[62,9,62,76,0],[63,5,63,6,0]]);
    </script>
  </body>
</html>