<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>p:\stuff\projects\minigamesproject\minigamesproject\assets\_assets\scripts\games\tankgame\tankcontroller.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class TankController : MonoBehaviour {

    #region fields
    private TankNetworking net;
    private TankPlayer player;

    [SerializeField]
    private float speed, rotateSpeed;
    public void SetSpeeds(float speed, float rotateSpeed) {
        this.speed = speed;
        this.rotateSpeed = rotateSpeed;
    }

    private TankControls controls;
    private TankWeapon weapon;

    public bool BlockMove { get; set; }

    private Rigidbody rb;

    [SerializeField]
    private GameObject bulletPrefab;

    private int fireIndex = 0;
    #endregion


    private void Start() {

        player = GetComponent&lt;TankPlayer&gt;();

        
        rb = GetComponent&lt;Rigidbody&gt;();
        controls = GetComponent&lt;TankControls&gt;();
        weapon = GetComponent&lt;TankWeapon&gt;();

        speed = TankSettings.TankSpeed;
        rotateSpeed = TankSettings.TankRotateSpeed;

        net = GetComponent&lt;TankNetworking&gt;();

        if (Server.Networker != null &amp;&amp; !Server.Networker.IsServer) {
            Destroy(this);
            return;
        }
    }
    public void SetMaterial() {

        Material material = transform.GetChild(0).GetChild(0).GetComponent&lt;MeshRenderer&gt;().material;

        string textureName = &quot;text_tank_body&quot; + (net.Owner.ID + 1);
        Texture tex = Resources.Load&lt;Texture&gt;(&quot;TankGame/Textures/&quot; + textureName);

        print(&quot;Setting &quot; + net.Owner.Name + &quot; color to &quot; + net.Owner.Color + &quot; &quot; + textureName);
        material.SetTexture(textureName, tex);
        material.color = Colors.GetBasicColor(net.Owner.Color);
    }

    private void Update() {

        if (net.State != TankPlayer.PlayerState.Enabled) {
            return;
        }

        FireAndPowerup();
        StopTank();
        MoveTank();
    }

    public void StopTank() {
        rb.velocity = Vector3.zero;
        rb.angularVelocity = Vector3.zero;
    }

    private void MoveTank() {

        if (BlockMove) {
            return;
        }

        Vector3 velocity = net.Movement.y * transform.forward * speed * Time.deltaTime;
        Vector3 eulerRotation = Vector3.up * net.Movement.x * rotateSpeed;
        Quaternion deltaRotation = Quaternion.Euler(eulerRotation * Time.deltaTime);

        // transform.eulerAngles += Vector3.forward * rotation;
        rb.MoveRotation(rb.rotation * deltaRotation);
        rb.MovePosition(rb.position + velocity);
    }
    private void FireAndPowerup() {
        weapon.Fire(net.Fire);
        weapon.Powerup(net.Powerup);
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[13,59,13,60,0],[14,9,14,28,0],[15,9,15,40,0],[16,5,16,6,0],[21,29,21,33,0],[21,34,21,38,0],[28,5,28,31,0],[32,26,32,27,0],[34,9,34,45,0],[37,9,37,40,0],[38,9,38,49,0],[39,9,39,45,0],[41,9,41,40,0],[42,9,42,52,0],[44,9,44,46,0],[46,9,46,68,0],[46,69,46,70,0],[47,13,47,27,0],[48,13,48,20,0],[50,5,50,6,0],[51,31,51,32,0],[53,9,53,101,0],[55,9,55,68,0],[56,9,56,83,0],[58,9,58,97,0],[59,9,59,47,0],[60,9,60,64,0],[61,5,61,6,0],[63,27,63,28,0],[65,9,65,57,0],[65,58,65,59,0],[66,13,66,20,0],[69,9,69,26,0],[70,9,70,20,0],[71,9,71,20,0],[72,5,72,6,0],[74,28,74,29,0],[75,9,75,36,0],[76,9,76,43,0],[77,5,77,6,0],[79,29,79,30,0],[81,9,81,23,0],[81,24,81,25,0],[82,13,82,20,0],[85,9,85,88,0],[86,9,86,75,0],[87,9,87,85,0],[90,9,90,54,0],[91,9,91,49,0],[92,5,92,6,0],[93,35,93,36,0],[94,9,94,31,0],[95,9,95,37,0],[96,5,96,6,0]]);
    </script>
  </body>
</html>