<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>p:\stuff\projects\minigamesproject\minigamesproject\assets\_assets\scripts\bearded man studios\scripts\networkbehavior.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using UnityEngine;

namespace BeardedManStudios.Forge.Networking.Unity
{
	public abstract class NetworkBehavior : MonoBehaviour, INetworkBehavior
	{
		public const byte RPC_SETUP_TRANSFORM = 4;

		public delegate void NetworkBehaviorEvent(NetworkBehavior behavior);

		public static Dictionary&lt;uint, NetworkBehavior&gt; skipAttachIds = new Dictionary&lt;uint, NetworkBehavior&gt;();

		public int TempAttachCode { get; set; }
		public bool Initialized { get; private set; }

		private NetworkObject waitingForNetworkObject;
		private uint waitingForNetworkObjectOffset;

		public event NetworkBehaviorEvent networkStarted;

		protected virtual void NetworkStart()
		{
			CompleteRegistration();

			if (networkStarted != null)
				networkStarted(this);
		}

		protected virtual void CompleteRegistration() { }

		public abstract void Initialize(NetworkObject obj);
		public abstract void Initialize(NetWorker networker, byte[] metadata = null);

		public void AwaitNetworkBind(NetWorker networker, NetworkObject createTarget, uint idOffset)
		{
			waitingForNetworkObject = createTarget;
			waitingForNetworkObjectOffset = idOffset;

			networker.objectCreated += NetworkBind;

			if (createTarget.NetworkId == 0)
				return;

			NetworkObject target;
			if (networker.NetworkObjects.TryGetValue(createTarget.NetworkId + idOffset, out target))
				NetworkBind(target);
		}

		private void NetworkBind(NetworkObject obj)
		{
			// This is always the network manager and should be ignored on late bindings
			if (obj.NetworkId == 0)
				return;

			if (obj.NetworkId != waitingForNetworkObject.NetworkId + waitingForNetworkObjectOffset &amp;&amp; obj.CreateCode != TempAttachCode)
				return;

			Initialize(obj);
			skipAttachIds.Remove(obj.NetworkId);

			obj.Networker.objectCreated -= NetworkBind;
		}

		protected void SetupHelperRpcs(NetworkObject networkObject)
		{
			networkObject.RegisterRpc(&quot;SetupTransform&quot;, SetupTransform, typeof(Vector3), typeof(Quaternion));
			Initialized = true;
		}

		public abstract NetworkObject CreateNetworkObject(NetWorker networker, int createCode, byte[] metadata = null);

		private void SetupTransform(RpcArgs args)
		{
			Action execute = () =&gt;
			{
				transform.position = args.GetNext&lt;Vector3&gt;();
				transform.rotation = args.GetNext&lt;Quaternion&gt;();
				InitializedTransform();
			};

			if (Rpc.MainThreadRunner != null)
				execute();
			else
				MainThreadManager.Run(execute);
		}

		protected abstract void InitializedTransform();

		[Obsolete(&quot;[Forge Networking] Please recompile your scripts in the Network Contract Wizard, your generated code is using a depricated method&quot;)]
		protected void ProcessOthers(Transform obj, uint idOffset)
		{
			Debug.LogError(&quot;[Forge Networking] Please recompile your scripts in the Network Contract Wizard, your generated code is using a depricated method&quot;);
			ProcessOthers(obj, ref idOffset);
		}

		protected void ProcessOthers(Transform obj, ref uint idOffset)
		{
			int i;

			var components = obj.GetComponents&lt;NetworkBehavior&gt;();

			// Create each network object that is available
			for (i = 0; i &lt; components.Length; i++)
			{
				if (components[i] == this)
					continue;

				skipAttachIds.Add(idOffset++, components[i]);
			}

			for (i = 0; i &lt; obj.childCount; i++)
				ProcessOthers(obj.GetChild(i), ref idOffset);
		}
	}
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[13,3,13,107,0],[15,31,15,35,0],[15,36,15,40,0],[16,29,16,33,0],[16,34,16,46,0],[24,3,24,4,0],[25,4,25,27,0],[27,4,27,31,0],[28,5,28,26,0],[29,3,29,4,0],[31,49,31,50,0],[31,51,31,52,0],[37,3,37,4,0],[38,4,38,43,0],[39,4,39,45,0],[41,4,41,43,0],[43,4,43,36,0],[44,5,44,12,0],[47,4,47,92,0],[48,5,48,25,0],[49,3,49,4,0],[52,3,52,4,0],[54,4,54,27,0],[55,5,55,12,0],[57,4,57,127,0],[58,5,58,12,0],[60,4,60,20,0],[61,4,61,40,0],[63,4,63,47,0],[64,3,64,4,0],[67,3,67,4,0],[68,4,68,101,0],[69,4,69,23,0],[70,3,70,4,0],[75,3,75,4,0],[76,4,77,4,0],[77,4,77,5,0],[77,5,78,5,0],[78,5,78,50,0],[78,50,79,5,0],[79,5,79,53,0],[79,53,80,5,0],[80,5,80,28,0],[80,28,81,4,0],[81,4,81,5,0],[81,5,81,6,0],[76,4,81,6,0],[83,4,83,37,0],[84,5,84,15,0],[86,5,86,36,0],[87,3,87,4,0],[93,3,93,4,0],[94,4,94,152,0],[95,4,95,37,0],[96,3,96,4,0],[99,3,99,4,0],[102,4,102,58,0],[105,9,105,14,0],[105,16,105,37,0],[105,39,105,42,0],[106,4,106,5,0],[107,5,107,31,0],[108,6,108,15,0],[110,5,110,50,0],[111,4,111,5,0],[113,9,113,14,0],[113,16,113,34,0],[113,36,113,39,0],[114,5,114,50,0],[115,3,115,4,0]]);
    </script>
  </body>
</html>