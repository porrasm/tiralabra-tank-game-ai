<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>p:\stuff\projects\minigamesproject\minigamesproject\assets\_assets\scripts\games\tankgame\tankai\tankai.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class TankAI : MonoBehaviour {

    #region fields
    private TankControls controls;
    private TankNetworking net;

    private TankDFSPath dfs;
    private TankAStarPath aStar;

    private Vector[] path;

    private TankAIMovement movement;
    private TankAIBulletChecker bullets;
    #endregion

    private void Start() {
        controls = GetComponent&lt;TankControls&gt;();
        net = GetComponent&lt;TankNetworking&gt;();

        TankGameManager.Instance().SubscribeRoundStart(ResetAI);
    }

    /// &lt;summary&gt;
    /// Resets the AI. This function is called before every round.
    /// &lt;/summary&gt;
    public void ResetAI() {

        print(&quot;reset ai&quot;);

        StopAllCoroutines();

        dfs = new TankDFSPath(TankLevelGenerator.Instance.Level);
        aStar = new TankAStarPath(TankLevelGenerator.Instance.Level);
        path = null;

        movement = new TankAIMovement(this);
        bullets = new TankAIBulletChecker(this);

        path = aStar.FindPath(Vector.PositionToCoords(transform.position),
            Vector.PositionToCoords(TankNetworking.MyTank().transform.position));

        movement.TraversePath(path);

        TankEvents.Instance.SubscribeToEvent(BulletEvent, TankEvents.EventType.BulletEvent);
    }

    private void BulletEvent() {

        print(&quot;Bullet event&quot;);

        bullets.CheckCollisionStatus();
        if (bullets.BulletWillHit) {
            DodgeBullets();
        }
    }

    private void Update() {

        if (net.State != TankPlayer.PlayerState.Enabled) {
            return;
        }

        ResetControls();


        if (Input.GetKeyDown(KeyCode.R)) {
            ResetAI();
        }
    }

    private void DodgeBullets() {

        print(&quot;Dodging bullet&quot;);

        IntCoords current = Vector.PositionToCoords(transform.position);
        movement.TraversePath(bullets.GetPathToSafeCoords(current, aStar));
    }

    private void ResetControls() {
        controls.ResetControls();
    }


}

public class AISettings {
    public static float TurnAngleLimit = 10f;
    public static float DistanceLimit = 0.5f;
    public static float MovementAngle = 15;

    #region Stuck settings
    public static float StuckTresholdTime = 0.2f;
    public static float StuckTresholdDistance = 0.05f;
    public static float AllowedStuckTime = 0.2f;
    public static float StuckCooldown = 0.5f;
    #endregion
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[20,26,20,27,0],[21,9,21,49,0],[22,9,22,46,0],[24,9,24,65,0],[25,5,25,6,0],[30,27,30,28,0],[32,9,32,27,0],[34,9,34,29,0],[36,9,36,66,0],[37,9,37,70,0],[38,9,38,21,0],[40,9,40,45,0],[41,9,41,49,0],[43,9,44,82,0],[46,9,46,37,0],[48,9,48,93,0],[49,5,49,6,0],[51,32,51,33,0],[53,9,53,31,0],[55,9,55,40,0],[56,9,56,35,0],[56,36,56,37,0],[57,13,57,28,0],[58,9,58,10,0],[59,5,59,6,0],[61,27,61,28,0],[63,9,63,57,0],[63,58,63,59,0],[64,13,64,20,0],[67,9,67,25,0],[70,9,70,41,0],[70,42,70,43,0],[71,13,71,23,0],[72,9,72,10,0],[73,5,73,6,0],[75,33,75,34,0],[77,9,77,33,0],[79,9,79,73,0],[80,9,80,76,0],[81,5,81,6,0],[83,34,83,35,0],[84,9,84,34,0],[85,5,85,6,0],[91,5,91,46,0],[92,5,92,46,0],[93,5,93,44,0],[96,5,96,50,0],[97,5,97,55,0],[98,5,98,49,0],[99,5,99,46,0]]);
    </script>
  </body>
</html>