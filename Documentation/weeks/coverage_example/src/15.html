<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>p:\stuff\projects\minigamesproject\minigamesproject\assets\_assets\scripts\games\tankgame\tankai\components\tankaibulletchecker.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class TankAIBulletChecker : TankAIComponent {

    #region fields

    private TankBulletTrajectory[] trajectories;

    public byte[,] CellBulletCounts { get; private set; }
    public bool BulletWillHit { get; set; }
    #endregion

    public TankAIBulletChecker(TankAI ai) : base(ai) {
    }

    public override void Update() {
        CheckCollisionStatus();
    }

    public void CheckCollisionStatus() {

        BulletWillHit = false;

        CellBulletCounts = new byte[TankSettings.LevelWidth, TankSettings.LevelHeight];

        GameObject[] bullets = GameObject.FindGameObjectsWithTag(&quot;Bullet&quot;);

        trajectories = new TankBulletTrajectory[bullets.Length];

        for (int i = 0; i &lt; bullets.Length; i++) {
            TankBulletTrajectory t = new TankBulletTrajectory(this, bullets[i].GetComponent&lt;TankBullet&gt;());
            t.CalculateTrajectory();

            TankPathVisualizer.DrawRoute(t.Trajectory);

            if (t.HitAI) {
                BulletWillHit = true;
            }
        }
    }
    public Vector[] GetPathToSafeCoords(IntCoords current, TankAIPathfinding pf) {

        bool FoundCondition(IntCoords c) {
            return CellBulletCounts[c.x, c.y] == 0;
        }

        return pf.FindPath(current, new IntCoords(-1, -1), FoundCondition);
    } 
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[11,39,11,43,0],[11,44,11,56,0],[12,33,12,37,0],[12,38,12,42,0],[15,45,15,53,0],[15,54,15,55,0],[16,5,16,6,0],[18,35,18,36,0],[19,9,19,32,0],[20,5,20,6,0],[22,40,22,41,0],[24,9,24,31,0],[26,9,26,88,0],[28,9,28,76,0],[30,9,30,65,0],[32,14,32,23,0],[32,25,32,43,0],[32,45,32,48,0],[32,50,32,51,0],[33,13,33,108,0],[34,13,34,37,0],[36,13,36,56,0],[38,13,38,25,0],[38,26,38,27,0],[39,17,39,38,0],[40,13,40,14,0],[41,9,41,10,0],[42,5,42,6,0],[43,82,43,83,0],[45,42,45,43,0],[46,13,46,52,0],[47,9,47,10,0],[49,9,49,76,0],[50,5,50,6,0]]);
    </script>
  </body>
</html>