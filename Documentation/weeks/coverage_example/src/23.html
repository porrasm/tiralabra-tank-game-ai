<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>p:\stuff\projects\minigamesproject\minigamesproject\assets\_assets\scripts\bearded man studios\scripts\logging\bmslogger.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using BeardedManStudios.Forge.Logging;
using UnityEngine;

public class BMSLogger : MonoBehaviour, IBMSLogger
{
	#region Singleton
	private static BMSLogger _instance;
	public static BMSLogger Instance
	{
		get
		{
			if (_instance == null)
				Init();
			return _instance;
		}
	}
	#endregion

	#region Public Data
	public bool LoggerVisible;
	public bool LogToFile;
	#endregion

	#region Private Data
	private bool showLogger = false;
	private static string filepath;
	private string BMSLogs;
	private object Mutex = new object();
	private Vector2 ScrollPos;
	private const string SAVE_FILE_DIRECTORY_NAME = &quot;Logs/&quot;;
	private const string SAVE_FILE_NAME = &quot;bmslog.txt&quot;;
	#endregion

	#region Runtime
	[RuntimeInitializeOnLoadMethod]
	private static void Init()
	{
		if (_instance != null)
			return;

#if !WINDOWS_UWP &amp;&amp; !UNITY_IOS
		string directory = Application.dataPath + &quot;/&quot; + SAVE_FILE_DIRECTORY_NAME;
		filepath = directory + SAVE_FILE_NAME;
		if (!System.IO.Directory.Exists(directory))
			System.IO.Directory.CreateDirectory(directory);
		if (!System.IO.File.Exists(filepath))
		{
			using (System.IO.File.Create(filepath))
			{

			}
		}
#endif

		GameObject prefab = Resources.Load&lt;GameObject&gt;(&quot;BMSLogger&quot;);
		if (prefab != null)
		{
			BMSLogger comp = prefab.GetComponent&lt;BMSLogger&gt;();
			_instance = new GameObject(&quot;BMSLogger&quot;, typeof(BMSLogger)).GetComponent&lt;BMSLogger&gt;();
			_instance.LoggerVisible = comp.LoggerVisible;
			_instance.LogToFile = comp.LogToFile;
		}
		else
			_instance = new GameObject(&quot;BMSLogger&quot;, typeof(BMSLogger)).GetComponent&lt;BMSLogger&gt;();

		if (_instance.LogToFile)
			Debug.LogFormat(&quot;Logging to file: {0}&quot;, filepath);
	}
	#endregion

	#region Public API
	public static void DebugLog(string log)
	{
		Instance.Log(log);
	}

	public void Log(string log)
	{
		PutLogInFile(BMSLog.Logtype.Info, log);
		BMSLogs += log + System.Environment.NewLine;

		if (!LoggerVisible)
			return;

		Debug.Log(log);
	}

	public void LogFormat(string log, params object[] args)
	{
		string logInfo = string.Format(log, args);
		PutLogInFile(BMSLog.Logtype.Info, logInfo);
		BMSLogs += logInfo + System.Environment.NewLine;

		if (!LoggerVisible)
			return;

		Debug.Log(logInfo);
	}

	public void LogWarning(string log)
	{
		string coloredWarning = string.Format(&quot;&lt;color=yellow&gt;{0}&lt;/color&gt;&quot;, log);
		PutLogInFile(BMSLog.Logtype.Warning, log);
		BMSLogs += coloredWarning + System.Environment.NewLine;

		if (!LoggerVisible)
			return;

		Debug.LogWarning(log);
	}

	public void LogWarningFormat(string log, params object[] args)
	{
		string logInfo = string.Format(log, args);
		string coloredWarning = string.Format(&quot;&lt;color=yellow&gt;{0}&lt;/color&gt;&quot;, logInfo);
		PutLogInFile(BMSLog.Logtype.Warning, logInfo);
		BMSLogs += coloredWarning + System.Environment.NewLine;

		if (!LoggerVisible)
			return;

		Debug.LogWarning(logInfo);
	}

	public void LogException(string log)
	{
		string coloredError = string.Format(&quot;&lt;color=red&gt;{0}&lt;/color&gt;&quot;, log);
		Debug.LogError(log);
		PutLogInFile(BMSLog.Logtype.Exception, log);
		BMSLogs += coloredError + System.Environment.NewLine;
	}

	public void LogExceptionFormat(string log, params object[] args)
	{
		string logInfo = string.Format(log, args);
		string coloredError = string.Format(&quot;&lt;color=red&gt;{0}&lt;/color&gt;&quot;, logInfo);
		Debug.LogError(logInfo);
		PutLogInFile(BMSLog.Logtype.Exception, logInfo);
		BMSLogs += coloredError + System.Environment.NewLine;
	}
	#endregion

	#region Unity API
	private void Awake()
	{
		if (_instance == null)
		{
			_instance = this;
			BMSLogs = string.Empty;
			ScrollPos = Vector2.zero;
			DontDestroyOnLoad(_instance.gameObject);
			BMSLog.Instance.RegisterLoggerService(_instance);
		}
	}

	private void Start()
	{
		if (LogToFile)
			BMSLog.Log(&quot;========= START RUN =========&quot;);
	}

	void OnGUI()
	{
		if (!LoggerVisible)
			return;

		showLogger = GUILayout.Toggle(showLogger, string.Empty);

		if (!showLogger)
			return;

		GUILayout.BeginArea(new Rect(0, Screen.height - (Screen.height * 0.3f), Screen.width * 0.4f, Screen.height * 0.3f));
		ScrollPos = GUILayout.BeginScrollView(ScrollPos);
		GUILayout.TextArea(BMSLogs, GUILayout.ExpandHeight(true), GUILayout.ExpandWidth(true));
		GUILayout.EndScrollView();
		GUILayout.EndArea();
	}
	#endregion

	private void PutLogInFile(BMSLog.Logtype type, string log)
	{
		// TODO:  Need to use the isolated storage for UWP and IOS
#if WINDOWS_UWP || UNITY_IOS
		return;
#else
		if (!LogToFile)
			return;

		lock (Mutex)
		{
			string read = string.Empty;
			using (System.IO.StreamReader sr = new System.IO.StreamReader(filepath))
			{
				read = sr.ReadToEnd();
			}

			string dlog = string.Format(&quot;[{0} - {1}] {2}&quot;, System.DateTime.Now.ToString(), type.ToString().ToUpper(), log);
			if (type == BMSLog.Logtype.Exception)
			{
				dlog = string.Format(&quot;{0}{1}{2}&quot;,
					dlog,
					System.Environment.NewLine,
					System.Environment.StackTrace);

			}
			string finalLog = string.Format(&quot;{0}{1}&quot;, read, dlog);

			using (System.IO.StreamWriter sw = new System.IO.StreamWriter(filepath))
			{
				sw.WriteLine(finalLog);
			}
		}
#endif
	}
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[11,3,11,4,0],[12,4,12,26,0],[13,5,13,12,0],[14,4,14,21,0],[15,3,15,4,0],[25,2,25,34,0],[28,2,28,38,0],[37,2,37,3,0],[38,3,38,25,0],[39,4,39,11,0],[42,3,42,76,0],[43,3,43,41,0],[44,3,44,46,0],[45,4,45,51,0],[46,3,46,40,0],[47,3,47,4,0],[48,4,48,43,0],[49,4,49,5,0],[51,4,51,5,0],[52,3,52,4,0],[55,3,55,63,0],[56,3,56,22,0],[57,3,57,4,0],[58,4,58,54,0],[59,4,59,89,0],[60,4,60,49,0],[61,4,61,41,0],[62,3,62,4,0],[64,4,64,89,0],[66,3,66,27,0],[67,4,67,54,0],[68,2,68,3,0],[73,2,73,3,0],[74,3,74,21,0],[75,2,75,3,0],[78,2,78,3,0],[79,3,79,42,0],[80,3,80,47,0],[82,3,82,22,0],[83,4,83,11,0],[85,3,85,18,0],[86,2,86,3,0],[89,2,89,3,0],[90,3,90,45,0],[91,3,91,46,0],[92,3,92,51,0],[94,3,94,22,0],[95,4,95,11,0],[97,3,97,22,0],[98,2,98,3,0],[101,2,101,3,0],[102,3,102,75,0],[103,3,103,45,0],[104,3,104,58,0],[106,3,106,22,0],[107,4,107,11,0],[109,3,109,25,0],[110,2,110,3,0],[113,2,113,3,0],[114,3,114,45,0],[115,3,115,79,0],[116,3,116,49,0],[117,3,117,58,0],[119,3,119,22,0],[120,4,120,11,0],[122,3,122,29,0],[123,2,123,3,0],[126,2,126,3,0],[127,3,127,70,0],[128,3,128,23,0],[129,3,129,47,0],[130,3,130,56,0],[131,2,131,3,0],[134,2,134,3,0],[135,3,135,45,0],[136,3,136,74,0],[137,3,137,27,0],[138,3,138,51,0],[139,3,139,56,0],[140,2,140,3,0],[145,2,145,3,0],[146,3,146,25,0],[147,3,147,4,0],[148,4,148,21,0],[149,4,149,27,0],[150,4,150,29,0],[151,4,151,44,0],[152,4,152,53,0],[153,3,153,4,0],[154,2,154,3,0],[157,2,157,3,0],[158,3,158,17,0],[159,4,159,48,0],[160,2,160,3,0],[163,2,163,3,0],[164,3,164,22,0],[165,4,165,11,0],[167,3,167,59,0],[169,3,169,19,0],[170,4,170,11,0],[172,3,172,119,0],[173,3,173,52,0],[174,3,174,90,0],[175,3,175,29,0],[176,3,176,23,0],[177,2,177,3,0],[181,2,181,3,0],[186,3,186,18,0],[187,4,187,11,0],[189,3,189,15,0],[190,3,190,4,0],[191,4,191,31,0],[192,11,192,75,0],[193,4,193,5,0],[194,5,194,27,0],[195,4,195,5,0],[197,4,197,115,0],[198,4,198,41,0],[199,4,199,5,0],[200,5,203,37,0],[205,4,205,5,0],[206,4,206,58,0],[208,11,208,75,0],[209,4,209,5,0],[210,5,210,28,0],[211,4,211,5,0],[212,3,212,4,0],[214,2,214,3,0]]);
    </script>
  </body>
</html>