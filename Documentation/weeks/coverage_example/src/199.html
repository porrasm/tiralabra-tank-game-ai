<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>p:\stuff\projects\minigamesproject\minigamesproject\assets\_assets\scripts\games\tankgame\tankai\tools\tankpathvisualizer.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using UnityEngine;

/// &lt;summary&gt;
/// This class is used for testing/debugging the pathfinding and level generation.
/// &lt;/summary&gt;
public class TankPathVisualizer : MonoBehaviour {

    #region fields
    TankDFSPath dfs;
    TankAStarPath aStar;
    LineRenderer line;

    private IntCoords start;

    public byte[,] level;
    #endregion

    private void Init() {
        dfs = new TankDFSPath(TankLevelGenerator.Instance.Level);
        aStar = new TankAStarPath(TankLevelGenerator.Instance.Level);
        line = GetComponent&lt;LineRenderer&gt;();
    }

    private void Update() {
        if (Input.GetKeyDown(KeyCode.R)) {
            dfs = null;
        }
        if (Input.GetKeyDown(KeyCode.T)) {
            level = TankLevelGenerator.Instance.Level;
            Init();
        }
        if (Input.GetKeyDown(KeyCode.X)) {

            Debug.Log(&quot;Creating test level&quot;);

            List&lt;TankLevelGenerator.Step&gt; steps = new List&lt;TankLevelGenerator.Step&gt;();

            for (int x = 0; x &lt; 10; x++) {
                for (int y = 0; y &lt; 10; y++) {
                    TankLevelGenerator.Step step = new TankLevelGenerator.Step();
                    step.Coords = new IntCoords(x, y);
                    step.Wall = TankCell.CellWall.Both;
                    steps.Add(step);
                }
            }

            Debug.Log(&quot;Step count: &quot; + steps.Count);

            TankMazeGenerator g = new TankMazeGenerator();
            g.LevelFromSteps(out level, steps);

            dfs = new TankDFSPath(level);
            aStar = new TankAStarPath(level);
            line = GetComponent&lt;LineRenderer&gt;();
        }

        if (Input.GetKeyDown(KeyCode.LeftShift)) {
            Comparison();
        }

        if (Input.GetKeyDown(KeyCode.Space)) {
            Vector3 world = Camera.main.ScreenToWorldPoint(Input.mousePosition);
            start = Vector.PositionToCoords(Vector.FromVector3(world));
        }
        if (Input.GetKeyDown(KeyCode.Mouse0)) {
            UpdateRouteAStar();
        }
        if (Input.GetKey(KeyCode.Mouse1)) {
            UpdateRouteDFS();
        }

        DrawLevel(level);
    }

    public void DrawLevel(byte[,] level) {

        if (level == null) {
            return;
        }

        for (int x = 0; x &lt; 10; x++) {
            for (int y = 0; y &lt; 10; y++) {
                DrawAvailable(new IntCoords(x, y), level[x, y]);
            }
        }

    }
    private void DrawAvailable(IntCoords coords, byte allowed) {

        for (int i = 0; i &lt; 8; i++) {

            TankDirection direction = (TankDirection)i;

            if (TankDirectionTools.AllowedDirection(allowed, direction)) {
                IntCoords newCoords = coords.MoveToDirection(direction);
                DrawLine(coords, newCoords);
            }
        }

    }
    private void DrawLine(IntCoords a, IntCoords b) {
        UnityEngine.Debug.DrawLine(Vector.ToVector3(Vector.CoordsToPosition(a)), Vector.ToVector3(Vector.CoordsToPosition(b)));
    }

    private void Comparison() {

        IntCoords start = new IntCoords();

        var watch = System.Diagnostics.Stopwatch.StartNew();

        for (int x = 1; x &lt; TankSettings.LevelWidth; x++) {
            for (int y = 1; y &lt; TankSettings.LevelHeight; y++) {
                dfs.FindPath(start, new IntCoords(x, y));
            }
        }

        watch.Stop();

        long elapsedDFS = watch.ElapsedMilliseconds;

        print(&quot;For DFS it took &quot; + elapsedDFS + &quot; millisecond to complete&quot;);

        watch = System.Diagnostics.Stopwatch.StartNew();
        for (int x = 1; x &lt; TankSettings.LevelWidth; x++) {
            for (int y = 1; y &lt; TankSettings.LevelHeight; y++) {
                aStar.FindPath(start, new IntCoords(x, y));
            }
        }

        watch.Stop();

        long elapsedAStar = watch.ElapsedMilliseconds;

        print(&quot;For A* it took &quot; + elapsedAStar + &quot; millisecond to complete&quot;);

        print(&quot;A* / DFS = &quot; + (1.0 * elapsedAStar / elapsedDFS));
        print(&quot;DFS / A* = &quot; + (1.0 * elapsedDFS / elapsedAStar));
    }

    private void UpdateRouteDFS() {

        if (dfs == null) {
            return;
        }

        IntCoords coords = MouseToCoords();
        //StartCoroutine(dfs.DFSSearchSafe(new IntCoords(0, 0), coords));


        DrawRoute(dfs.FindPath(start, coords));

        //DrawRoute(route);
    }
    private void UpdateRouteAStar() {

        if (aStar == null) {
            return;
        }

        IntCoords coords = MouseToCoords();
        //StartCoroutine(dfs.DFSSearchSafe(new IntCoords(0, 0), coords));

        Vector[] route = aStar.FindPath(start, coords);

        DrawRoute(route);

        //DrawRoute(route);
    }

    private IntCoords MouseToCoords() {

        Vector3 mouse = Input.mousePosition;
        Vector3 world = Camera.main.ScreenToWorldPoint(mouse);

        UnityEngine.Debug.DrawLine(Vector3.zero, world);

        return Vector.PositionToCoords(Vector.FromVector3(world));
    }

    private Vector3[] RouteToPos(Stack&lt;IntCoords&gt; route) {

        Vector3[] pos = new Vector3[route.Count];

        for (int i = 0; i &lt; pos.Length; i++) {
            pos[pos.Length - 1 - i] = Vector.ToVector3(Vector.CoordsToPosition(route.Pop()));
        }

        return pos;
    }

    public static void DrawRoute(Vector[] positions) {
        DrawRoute(positions.Select(o =&gt; o.Vector3).ToArray());
    }
    public static void DrawRoute(Vector3[] positions) {
        LineRenderer line = GameObject.FindGameObjectWithTag(&quot;Scripts&quot;).GetComponent&lt;LineRenderer&gt;();
        if (line == null) {
            return;
        }

        line.positionCount = positions.Length;
        line.SetPositions(positions);
    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[21,25,21,26,0],[22,9,22,66,0],[23,9,23,70,0],[24,9,24,45,0],[25,5,25,6,0],[27,27,27,28,0],[28,9,28,41,0],[28,42,28,43,0],[29,13,29,24,0],[30,9,30,10,0],[31,9,31,41,0],[31,42,31,43,0],[32,13,32,55,0],[33,13,33,20,0],[34,9,34,10,0],[35,9,35,41,0],[35,42,35,43,0],[37,13,37,46,0],[39,13,39,87,0],[41,18,41,27,0],[41,29,41,35,0],[41,37,41,40,0],[41,42,41,43,0],[42,22,42,31,0],[42,33,42,39,0],[42,41,42,44,0],[42,46,42,47,0],[43,21,43,82,0],[44,21,44,55,0],[45,21,45,56,0],[46,21,46,37,0],[47,17,47,18,0],[48,13,48,14,0],[50,13,50,53,0],[52,13,52,59,0],[53,13,53,48,0],[55,13,55,42,0],[56,13,56,46,0],[57,13,57,49,0],[58,9,58,10,0],[60,9,60,49,0],[60,50,60,51,0],[61,13,61,26,0],[62,9,62,10,0],[64,9,64,45,0],[64,46,64,47,0],[65,13,65,81,0],[66,13,66,72,0],[67,9,67,10,0],[68,9,68,46,0],[68,47,68,48,0],[69,13,69,32,0],[70,9,70,10,0],[71,9,71,42,0],[71,43,71,44,0],[72,13,72,30,0],[73,9,73,10,0],[75,9,75,26,0],[76,5,76,6,0],[78,42,78,43,0],[80,9,80,27,0],[80,28,80,29,0],[81,13,81,20,0],[84,14,84,23,0],[84,25,84,31,0],[84,33,84,36,0],[84,38,84,39,0],[85,18,85,27,0],[85,29,85,35,0],[85,37,85,40,0],[85,42,85,43,0],[86,17,86,65,0],[87,13,87,14,0],[88,9,88,10,0],[90,5,90,6,0],[91,64,91,65,0],[93,14,93,23,0],[93,25,93,30,0],[93,32,93,35,0],[93,37,93,38,0],[95,13,95,56,0],[97,13,97,73,0],[97,74,97,75,0],[98,17,98,73,0],[99,17,99,45,0],[100,13,100,14,0],[101,9,101,10,0],[103,5,103,6,0],[104,53,104,54,0],[105,9,105,128,0],[106,5,106,6,0],[108,31,108,32,0],[110,9,110,43,0],[112,9,112,61,0],[114,14,114,23,0],[114,25,114,52,0],[114,54,114,57,0],[114,59,114,60,0],[115,18,115,27,0],[115,29,115,57,0],[115,59,115,62,0],[115,64,115,65,0],[116,17,116,58,0],[117,13,117,14,0],[118,9,118,10,0],[120,9,120,22,0],[122,9,122,53,0],[124,9,124,77,0],[126,9,126,57,0],[127,14,127,23,0],[127,25,127,52,0],[127,54,127,57,0],[127,59,127,60,0],[128,18,128,27,0],[128,29,128,57,0],[128,59,128,62,0],[128,64,128,65,0],[129,17,129,60,0],[130,13,130,14,0],[131,9,131,10,0],[133,9,133,22,0],[135,9,135,55,0],[137,9,137,78,0],[139,9,139,66,0],[140,9,140,66,0],[141,5,141,6,0],[143,35,143,36,0],[145,9,145,25,0],[145,26,145,27,0],[146,13,146,20,0],[149,9,149,44,0],[153,9,153,48,0],[156,5,156,6,0],[157,37,157,38,0],[159,9,159,27,0],[159,28,159,29,0],[160,13,160,20,0],[163,9,163,44,0],[166,9,166,56,0],[168,9,168,26,0],[171,5,171,6,0],[173,39,173,40,0],[175,9,175,45,0],[176,9,176,63,0],[178,9,178,57,0],[180,9,180,67,0],[181,5,181,6,0],[183,58,183,59,0],[185,9,185,50,0],[187,14,187,23,0],[187,25,187,39,0],[187,41,187,44,0],[187,46,187,47,0],[188,13,188,94,0],[189,9,189,10,0],[191,9,191,20,0],[192,5,192,6,0],[194,54,194,55,0],[195,9,195,41,0],[195,41,195,50,0],[195,50,195,63,0],[195,9,195,63,0],[196,5,196,6,0],[197,55,197,56,0],[198,9,198,102,0],[199,9,199,26,0],[199,27,199,28,0],[200,13,200,20,0],[203,9,203,47,0],[204,9,204,38,0],[205,5,205,6,0]]);
    </script>
  </body>
</html>